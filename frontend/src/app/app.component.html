<!Doctype html>
<html>
    <head>
        <!-- <link rel="stylesheet" type="text/css" href="index.css"> -->
        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <script src="/js/bootstrap.min.js"></script>
    </head>
    <body>
        <h1 class="banner" id="market">Market</h1>

        <div class="login">
            <input type="email" placeholder="email" name="email" id="email" required> <br><br>
            <input type="password" placeholder="password" name="psw" id="password" required> <br><br>
            <Button variant="primary" type="submit" onclick="login()">Login</Button>  
            <Button type="submit" onclick="signup()">Sign up</Button>
        </div>

        <script>
              async function login(){
                email = document.getElementById('email').value
                password = document.getElementById('password').value

                const url = "http://localhost:8000/login"
                const headers = {"Content-Type" : "application/json; charset=utf-8"}
                const body = JSON.stringify({ email: email, password: password})
                
                try {   

                    const res = await fetch(url, {
                        method : "POST", 
                        mode: "cors",
                        headers : headers, 
                        body : body
                    })

                    const data = await res.json()

                    if (data["token"]) {
                        // CREATE COOKIE FOR USER
                        document.cookie = "market_token="+data['token'] 
                        location.replace("/dashboard")
                        return
                    }

                    throw error

                } catch(err) {
                    alert("Failure to login")
                }
            }

            function signup(){
                location.replace("/signup")
            }
        </script>


    </body>
</html>