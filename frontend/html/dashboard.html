<!Doctype html>
<html>
    <head id="">
        <link rel="stylesheet" type="text/css" href="dashboard.css">
        <title>Dashboard</title>

        <!-- LINKS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

        <script>
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
            
        </script>

    </head>
    <body class=dashboard-body onLoad="getDashboard()">

        <nav class="user-nav">
            <a class="transaction-nav" style="margin-right: 1%;" href="transactions.html">Transaction</a>
            <a class="people-nav" href="community.html">Community</a>
            <a class="messagas-nav" href="messages.html">Messages</a>
        </nav>  
        
        <br>

        <h1 class="banner">Market</h1>

        <div class="profile">
            <!-- user avatar -->
            <div class="avatar-div">
                <a href="./profile.html">
                    <img class="avatar" src="avatar.png" alt="avatar">
                </a>
                <p id="first_name" class="first_name"></p>
                <p id="last_name" class="last_name"></p>
            </div>
        </div>

        <div class="user-history">
            <div class="requests">
                Requests    
                
                <br>
                <div class="bootstrap-list">
                    <div class="list-group">
                        <div id="request_list">
                            <!-- <a href="#" class="list-group-item list-group-item-action" style="display: flex; font-size: medium;">
                                <div style="width: 60%;"> Micheal Jordan <br>
                                    5
                                </div>
                                <div style="width: 40%;">
                                    Software Engineering
                                </div>
                            </a> -->
                        </div>
                        <!-- <a href="#" class="list-group-item list-group-item-action">Request 2</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 3</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 4</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 5</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 6</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 7</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 8</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 9</a>
                        <a href="#" class="list-group-item list-group-item-action">Request 10</a> -->
                    </div>
                </div>
            </div>

            <div class="feedback">
                Feedback

                <br>
                <div class=bootstrap-list>
                    <div class="list-group">
                        <div id="feedback-list">
                        <!-- <a href="#" class="list-group-item list-group-item-action">Feedback 1</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 2</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 3</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 4</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 5</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 6</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 7</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 8</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 9</a>
                        <a href="#" class="list-group-item list-group-item-action">Feedback 10</a> -->
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <br>

        <footer class="dashboard-footer">
            
        </footer>

        <script>
            function getDashboard(){

                // get the users cookies
                cookies = document.cookie.split(';')
                market_token = ''

                // retreive market_cookie from cookies
                for(i = 0; i < cookies.length; i++){
                    if(cookies[i].includes('market_token=')){
                        market_token = cookies[i].split('market_token=')[1]
                    }
                }

                fetch("http://127.0.0.1:5000/dashboard",
                    {
                        method: "POST",
                        mode: "cors",
                        headers: {
                            "Content-Type" : "application/json; charset=utf-8"
                        },
                        body: JSON.stringify({
                            token: market_token
                        })
                    }
                    ).then(response => response.json())
                    .then(data => {
                        // entire dataset
                        dash_data = data.dashboard
                        console.log(dash_data)

                        // insert users first name and last name
                        first_name = dash_data.first_name
                        last_name = dash_data.last_name
                        console.log(first_name)
                        console.log(last_name)

                        document.querySelector("#first_name").insertAdjacentHTML("afterbegin", first_name)
                        document.querySelector("#last_name").insertAdjacentHTML("afterbegin", last_name)

                        // insert requests in requests list
                        requests = dash_data.request
                        for(i = 0; i < requests.length; i++){
                            document.getElementById("request_list").insertAdjacentHTML("afterbegin",`
                            <a href="#" class="list-group-item list-group-item-action" style="display: flex; font-size: medium;">
                                <div style="width: 60%;"> ${requests[i][0] + " " + requests[i][1]} <br>
                                    ${getRatingConfig(requests[i][3])}
                                </div>
                                <div style="width: 40%;">
                                    ${requests[i][2]}
                                </div>
                            </a>
                            `)
                        }
                        console.log(requests)

                        // insert feedback in feedback list
                        feedback = dash_data.feedback
                        for(i = 0; i < feedback.length; i++){
                            document.getElementById("feedback-list").insertAdjacentHTML("afterbegin", `
                            <a href="#" class="list-group-item list-group-item-action" style="display: flex; font-size: medium;">
                                <div style="width: 60%;"> ${feedback[i][0] + " " + feedback[i][1]} <br>
                                    ${feedback[i][2]}
                                </div>
                                <div style="width: 40%;">
                                    ${getRatingConfig(feedback[i][3])}
                                </div>
                            </a>
                            `)
                        }

                        console.log(feedback)


                        
                    }
                )
            }

            // used to get color associations with the ratings (can be used later for starts etc)
            function getRatingConfig(num){
                rating = String(num)
                if(num >= 4.5){
                    return rating.fontcolor("green")
                }else if(num >= 4.0){
                    return rating.fontcolor("yellowgreen")
                }else if(num >= 3.5){
                    return rating.fontcolor("#CDD704")
                }else if(num >= 3.0){
                    return rating.fontcolor("gold")
                }else if(num >= 2.5){
                    return rating.fontcolor("darkorange")
                }else{
                    return rating.fontcolor("red")
                }

                return rating
            }
            
        </script>

    </body>
</html>